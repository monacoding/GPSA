<!-- HEADì— Toast UI Editor CDN ì¶”ê°€ -->
<link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css">
<script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>

{% extends "base.html" %}
{% block content %}
    <div class="main-content">
        <h2>âœ ê¸€ ì‘ì„±</h2>

        <form action="{{ url_for('board.write_post') }}" method="POST" enctype="multipart/form-data" class="board-form">
            <div class="form-group">
                <label for="category">ì£¼ì œ</label>
                <input type="text" name="category" id="category" required placeholder="ì˜ˆ: ì§ˆë¬¸, ì •ë³´, í›„ê¸° ë“±">
            </div>

            <div class="form-group">
                <label for="title">ì œëª©</label>
                <input type="text" name="title" id="title" required placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>

            <div class="form-group">
                <label for="editor">ë‚´ìš©</label>
                <input type="hidden" name="content" id="hidden-content">
                <div id="editor"></div>
            </div>

            <div class="form-group">
                <label for="attachment">íŒŒì¼ ì²¨ë¶€</label>
                <input type="file" name="attachment" id="attachment">
            </div>

            <div class="form-group text-right">
                <button type="submit" class="submit-btn">ğŸ“ ë“±ë¡</button>
            </div>
        </form>

        <script>
            const editor = new toastui.Editor({
                el: document.querySelector('#editor'),
                height: '400px',
                initialEditType: 'wysiwyg',
                previewStyle: 'vertical',
                hooks: {
                    addImageBlobHook: async (blob, callback) => {
                        const formData = new FormData();
                        formData.append('image', blob);
                        const response = await fetch('/board/upload_image', {
                            method: 'POST',
                            body: formData
                        });
                        const data = await response.json();
                        callback(data.url, 'image');
                    }
                }
            });

            // í¼ ì œì¶œ ì‹œ ì—ë””í„° ë‚´ìš©ì„ hidden inputì— ì‚½ì…
            document.querySelector('form').addEventListener('submit', function () {
                document.querySelector('#hidden-content').value = editor.getHTML();
            });

            // ì´ë¯¸ì§€ì— resizable-wrapper ê°ì‹¸ê¸°
            document.addEventListener('DOMSubtreeModified', () => {
                const images = document.querySelectorAll('.toastui-editor-contents img');
                images.forEach(img => {
                    if (!img.closest('.resizable-wrapper')) {
                        const wrapper = document.createElement('div');
                        wrapper.className = 'resizable-wrapper';
                        img.parentNode.insertBefore(wrapper, img);
                        wrapper.appendChild(img);
                    }
                });
            });
        </script>
    </div>
{% endblock %}