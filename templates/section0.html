{% extends "base.html" %}
{% block content %}

<h2>ğŸ§ª í˜¼í•©ë¬¼ ë¬¼ì„±ì¹˜ ê³„ì‚°ê¸°</h2>

<!-- JSì—ì„œ ì‚¬ìš©í•  ì»´í¬ë„ŒíŠ¸ ë¦¬ìŠ¤íŠ¸ -->
<script>
    const COMPONENTS = {{ components | tojson }};
</script>

<form method="POST" class="form-container">

    <fieldset>
        <legend>1. êµ¬ì„± ì„±ë¶„ + ëª°ë¶„ìœ¨ ì…ë ¥</legend>
        <div id="components-area" class="component-group">
            <div class="component-row">
                <label>Component:</label>
                <select name="component">
                    {% for comp in components %}
                        <option value="{{ comp }}">{{ comp }}</option>
                    {% endfor %}
                </select>
                <label>Mole Fraction:</label>
                <input type="number" name="mole_fraction" step="any" min="0" max="1" required>
                <button type="button" class="remove-btn" onclick="removeComponent(this)">â–</button>
            </div>
        </div>
        <button type="button" onclick="addComponent()">â• ì„±ë¶„ ì¶”ê°€</button>
    </fieldset>

    <fieldset>
        <legend>2. ì˜¨ë„ ë° ì••ë ¥ ì…ë ¥</legend>
        <div class="input-group">
            <label>ì˜¨ë„ (Â°C):</label>
            <input type="number" name="T" step="any" required>
            <label>ì••ë ¥ (bar):</label>
            <input type="number" name="P" step="any" required>
        </div>
    </fieldset>

    <button type="submit" class="submit-btn">ğŸ“Š ê³„ì‚°í•˜ê¸°</button>
</form>

<hr>

{% if result %}
<h3>ğŸ“„ ê³„ì‚° ê²°ê³¼</h3>

{% if result.error %}
<p style="color: red;">âš ï¸ ì˜¤ë¥˜: {{ result.error }}</p>
{% else %}
<table class="result-table">
    <thead>
        <tr>
            <th>ğŸ“Œ Property</th>
            <th style="text-align:right;">Value</th>
            <th>Unit</th>
        </tr>
    </thead>
    <tbody>
        {% for name, data in result.items() %}
        <tr>
            <td>{{ name }}</td>
            <td style="text-align: right;">
                {% if data.value is string %}
                    <span style="color: #f66;">{{ data.value }}</span>
                {% elif data.value is defined %}
                    {{ "{:,.5g}".format(data.value) }}
                {% else %}
                    -
                {% endif %}
            </td>
            <td>{{ data.unit or '-' }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}
{% endif %}

<!-- ğŸ”§ ì»´í¬ë„ŒíŠ¸ ì¶”ê°€/ì‚­ì œ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
function addComponent() {
    const area = document.getElementById('components-area');
    const row = document.createElement('div');
    row.className = 'component-row';

    let options = '';
    COMPONENTS.forEach(comp => {
        options += `<option value="${comp}">${comp}</option>`;
    });

    row.innerHTML = `
        <label>Component:</label>
        <select name="component">${options}</select>
        <label>Mole Fraction:</label>
        <input type="number" name="mole_fraction" step="any" min="0" max="1" required>
        <button type="button" class="remove-btn" onclick="removeComponent(this)">â–</button>
    `;

    area.appendChild(row);
}

function removeComponent(button) {
    const row = button.parentElement;
    row.remove();
}
</script>

{% endblock %}