{% extends "base.html" %}
{% block content %}

<h2>🧪 혼합물 물성치 계산기</h2>

<form method="POST" class="form-container">

    <!-- 1. 구성 성분 -->
    <fieldset>
        <legend>1. 구성 성분 + 몰분율 입력</legend>
        <div id="components-area" class="component-group">
            <div class="component-row">
                <label>Component:</label>
                <select name="component">
                    <option value="Methane">Methane</option>
                    <option value="Ethane">Ethane</option>
                    <option value="Propane">Propane</option>
                    <option value="Butane">Butane</option>
                    <option value="Nitrogen">Nitrogen</option>
                    <option value="CarbonDioxide">Carbon Dioxide</option>
                </select>
                <label>Mole Fraction:</label>
                <input type="number" name="mole_fraction" step="any" min="0" max="1" required>
            </div>
        </div>
        <button type="button" onclick="addComponent()">➕ 성분 추가</button>
    </fieldset>

    <!-- 2. 온도/압력 -->
    <fieldset>
        <legend>2. 온도 및 압력 입력</legend>
        <div class="input-group">
            <label>온도 (°C):</label>
            <input type="number" name="T" step="any" required>
            <label>압력 (bar):</label>
            <input type="number" name="P" step="any" required>
        </div>
    </fieldset>

    <!-- 계산 버튼 -->
    <button type="submit" class="submit-btn">📊 계산하기</button>
</form>

<hr>

<!-- 계산 결과 출력 -->
{% if result %}
<h3>📄 계산 결과</h3>

{% if result.error %}
<p style="color: red;">⚠️ 오류: {{ result.error }}</p>
{% else %}
<table class="result-table">
    <thead>
        <tr>
            <th>📌 Property</th>
            <th style="text-align:right;">Value</th>
            <th>Unit</th>
        </tr>
    </thead>
    <tbody>
        {% for name, data in result.items() %}
        <tr>
            <td>{{ name }}</td>
            <td style="text-align: right;">
                {% if data.value is string %}
                    <span style="color: #f66;">{{ data.value }}</span>
                {% elif data.value is defined %}
                    {{ "{:,.5g}".format(data.value) }}
                {% else %}
                    -
                {% endif %}
            </td>
            <td>{{ data.unit or '-' }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}
{% endif %}

<script>
function addComponent() {
    const area = document.getElementById('components-area');
    const row = document.createElement('div');
    row.className = 'component-row';
    row.innerHTML = `
        <label>Component:</label>
        <select name="component">
            <option value="Methane">Methane</option>
            <option value="Ethane">Ethane</option>
            <option value="Propane">Propane</option>
            <option value="Butane">Butane</option>
            <option value="Nitrogen">Nitrogen</option>
            <option value="CarbonDioxide">Carbon Dioxide</option>
        </select>
        <label>Mole Fraction:</label>
        <input type="number" name="mole_fraction" step="any" min="0" max="1" required>
    `;
    area.appendChild(row);
}
</script>

{% endblock %}