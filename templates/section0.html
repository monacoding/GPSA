{% extends "base.html" %}
{% block content %}

<h2>ğŸ§ª í˜¼í•©ë¬¼ ë¬¼ì„±ì¹˜ ê³„ì‚°ê¸°(CoolProp ê¸°ë°˜)</h2>

<script>
    const COMPONENTS = {{ components | tojson }};
</script>

<form method="POST" class="form-container">
    <fieldset>
        <legend>1. êµ¬ì„± ì„±ë¶„ + ëª°ë¶„ìœ¨ ì…ë ¥</legend>
        <div id="components-area" class="component-group">
            <div class="component-row">
                <label>Component:</label>
                <select name="component">
                    {% for comp in components %}
                        <option value="{{ comp }}">{{ comp }}</option>
                    {% endfor %}
                </select>
                <label>Mole Fraction:</label>
                <input type="number" name="mole_fraction" step="any" min="0" max="1" required>
                <button type="button" class="remove-btn" onclick="removeComponent(this)">â–</button>
            </div>
        </div>
        <button type="button" onclick="addComponent()">â• ì„±ë¶„ ì¶”ê°€</button>
    </fieldset>

    <fieldset> 
        <legend>2. ì˜¨ë„ ë° ì••ë ¥ ì…ë ¥</legend>
        <div class="input-group">
            <label>ì˜¨ë„ (Â°C):</label>
            <input type="number" name="T" step="any" required placeholder = "ì˜ˆ)-163">
            <label>ì••ë ¥ (barG):</label>
            <input type="number" name="P" step="any" required placeholder = "ì˜ˆ)13">
            <button type="submit" class="submit-btn">ğŸ“Š ê³„ì‚°í•˜ê¸°</button>
         
        </div>
    </fieldset>

    
</form>

<hr>

{% if result %}
    <h3>ğŸ“„ ê³„ì‚° ê²°ê³¼</h3>

    {% if result.error %}
        <p style="color: red;">âš ï¸ ì˜¤ë¥˜: {{ result.error }}</p>
    {% else %}
        <table class="result-table">
            <thead>
                <tr>
                    <th>ğŸ“Œ Property</th>
                    <th style="text-align:right;">Value</th>
                    <th>Unit</th>
                </tr>
            </thead>
            <tbody>
                {% for name, data in result.items() %}
                    {% if name != '__phase_diagram__' %}
                    <tr>
                        <td>{{ name }}</td>
                        <td style="text-align: right;">
                            {% if data.value is string %}
                                <span style="color: #f66;">{{ data.value }}</span>
                            {% elif data.value is defined %}
                                {{ "{:,.5g}".format(data.value) }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>{{ data.unit or '-' }}</td>
                    </tr>
                    {% endif %}
                {% endfor %}
            </tbody>
        </table>

        {% if '__phase_diagram__' in result and 'image_base64' in result['__phase_diagram__'] %}
            <h3>ğŸŒ¡ï¸ Phase diagram</h3>
            <img src="{{ result['__phase_diagram__']['image_base64'] }}" alt="Phase Diagram"
                 style="max-width:100%; border:1px solid #ccc; margin-top:20px;">
        {% endif %}
    {% endif %}
{% endif %}

<script>
function addComponent() {
    const area = document.getElementById('components-area');
    const row = document.createElement('div');
    row.className = 'component-row';

    let options = '';
    COMPONENTS.forEach(comp => {
        options += `<option value="${comp}">${comp}</option>`;
    });

    row.innerHTML = `
        <label>Component:</label>
        <select name="component">${options}</select>
        <label>Mole Fraction:</label>
        <input type="number" name="mole_fraction" step="any" min="0" max="1" required>
        <button type="button" class="remove-btn" onclick="removeComponent(this)">â–</button>
    `;

    area.appendChild(row);
}

function removeComponent(button) {
    const row = button.parentElement;
    row.remove();
}
</script>

{% endblock %}